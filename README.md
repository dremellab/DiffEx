# ğŸ§¬ diffex â€” Differential Expression Analysis with edgeR + Quarto

![diffex logo](https://img.shields.io/badge/DE-analysis-success?style=flat-square&logo=r)

`diffex` is a reproducible and portable tool that performs differential gene expression (DGE) analysis using the **edgeR** package and generates an interactive **Quarto HTML report** ğŸ“Š â€” ready for publication or exploration.

Built with â¤ï¸ for users of the **HAROLD** RNA-seq pipeline, `diffex` takes the output `counts_matrix.tsv` and `samplesheet.tsv` and produces beautifully summarized DEG results with visualization-rich reporting.

---

## ğŸš€ Features

- âœ… Accepts count matrix and sample metadata from **HAROLD**
- ğŸ§ª Uses **edgeR** for robust DE testing
- ğŸ“Š Produces interactive Quarto HTML reports
- ğŸŒ‹ Includes volcano plots, PCA, box/violin plots, and summary tables
- ğŸ” Easily configurable parameters via CLI or YAML
- ğŸ³ Dockerized for reproducibility

---

## ğŸ“ Input Files

1. **`counts_matrix.tsv`** â€“ gene Ã— sample raw count matrix  
   - Rows = genes (Ensembl or SYMBOL)
   - Columns = sample names

2. **`samplesheet.tsv`** â€“ sample metadata  
   Required columns:
   - `sampleName` â€“ matches column headers in counts
   - `groupName` â€“ experimental group (e.g. `WT`, `KO`)

> These files are directly generated by the HAROLD pipeline.

---

## ğŸ§ª How it Works

1. `diffex` reads in count and sample metadata files
2. Performs filtering, normalization (TMM or ERCC)
3. Uses **edgeR** to perform DE analysis
4. Annotates results and saves:
   - `deg_results.tsv` (full table)
   - `deg_results.xlsx` (Excel version)
   - `normalized_counts.tsv`
5. Renders an HTML report with:
   - PCA & volcano plots
   - Summary tables
   - Interactive DEG explorer

---

## ğŸ’» Usage

### ğŸ”§ Via Python CLI

```bash
diffex \
  --counts_file data/counts_matrix.tsv \
  --samplesheet data/samplesheet.tsv \
  --group1 WT_72h \
  --group2 KO_72h \
  --normalization_method TMM \
  --sample_column sampleName \
  --group_column groupName \
  --design_formula "~ groupName" \
  --normalized_counts_file normalized.tsv \
  --deg_results_file degs.tsv
```

This runs the Quarto-based report using the provided parameters.

### ğŸ³ With Docker
```bash
docker run --rm -v $PWD:/app <docker_URI> diffex \
  --counts_file data/counts_matrix.tsv \
  --samplesheet data/samplesheet.tsv \
  --group1 WT_72h \
  --group2 KO_72h \
  --normalization_method TMM \
  --sample_column sampleName \
  --group_column groupName \
  --design_formula "~ groupName" \
  --normalized_counts_file normalized.tsv \
  --deg_results_file degs.tsv
```

## ğŸ“Š Outputs

|File | Description |
|--|--|
| `deg_results.tsv` | Full DE results table
| `deg_results.xlsx` | Excel version of results
| `normalized_counts.tsv` | Library-size normalized matrix
| `diffex_report.html` | ğŸ”¥ Interactive DE report (with PCA, volcano, etc)

## ğŸ™Œ Acknowledgements

- ğŸ’¡ Powered by edgeR, limma
- ğŸ“š Reporting via Quarto

## ğŸ“œ License

MIT

âœ¨ Happy diffex-ing!
