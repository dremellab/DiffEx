# 🧬 diffex — Differential Expression Analysis with edgeR + Quarto

![diffex logo](https://img.shields.io/badge/DE-analysis-success?style=flat-square&logo=r)

`diffex` is a reproducible and portable tool that performs differential gene expression (DGE) analysis using the **edgeR** package and generates an interactive **Quarto HTML report** 📊 — ready for publication or exploration.

Built with ❤️ for users of the **HAROLD** RNA-seq pipeline, `diffex` takes the output `counts_matrix.tsv` and `samplesheet.tsv` and produces beautifully summarized DEG results with visualization-rich reporting.

---

## 🚀 Features

- ✅ Accepts count matrix and sample metadata from **HAROLD**
- 🧪 Uses **edgeR** for robust DE testing
- 📊 Produces interactive Quarto HTML reports
- 🌋 Includes volcano plots, PCA, box/violin plots, and summary tables
- 🔍 Easily configurable parameters via CLI or YAML
- 🐳 Dockerized for reproducibility

---

## 📁 Input Files

1. **`counts_matrix.tsv`** – gene × sample raw count matrix  
   - Rows = genes (Ensembl or SYMBOL)
   - Columns = sample names

2. **`samplesheet.tsv`** – sample metadata  
   Required columns:
   - `sampleName` – matches column headers in counts
   - `groupName` – experimental group (e.g. `WT`, `KO`)

> These files are directly generated by the HAROLD pipeline.

---

## 🧪 How it Works

1. `diffex` reads in count and sample metadata files
2. Performs filtering, normalization (TMM or ERCC)
3. Uses **edgeR** to perform DE analysis
4. Annotates results and saves:
   - `deg_results.tsv` (full table)
   - `deg_results.xlsx` (Excel version)
   - `normalized_counts.tsv`
5. Renders an HTML report with:
   - PCA & volcano plots
   - Summary tables
   - Interactive DEG explorer

---

## 💻 Usage

### 🔧 Via Python CLI

```bash
diffex \
  --counts_file data/counts_matrix.tsv \
  --samplesheet data/samplesheet.tsv \
  --group1 WT_72h \
  --group2 KO_72h \
  --normalization_method TMM \
  --sample_column sampleName \
  --group_column groupName \
  --design_formula "~ groupName" \
  --normalized_counts_file normalized.tsv \
  --deg_results_file degs.tsv
```

This runs the Quarto-based report using the provided parameters.

### 🐳 With Docker
```bash
docker run --rm -v $PWD:/app <docker_URI> diffex \
  --counts_file data/counts_matrix.tsv \
  --samplesheet data/samplesheet.tsv \
  --group1 WT_72h \
  --group2 KO_72h \
  --normalization_method TMM \
  --sample_column sampleName \
  --group_column groupName \
  --design_formula "~ groupName" \
  --normalized_counts_file normalized.tsv \
  --deg_results_file degs.tsv
```

## 📊 Outputs

|File | Description |
|--|--|
| `deg_results.tsv` | Full DE results table
| `deg_results.xlsx` | Excel version of results
| `normalized_counts.tsv` | Library-size normalized matrix
| `diffex_report.html` | 🔥 Interactive DE report (with PCA, volcano, etc)

## 🙌 Acknowledgements

- 💡 Powered by edgeR, limma
- 📚 Reporting via Quarto

## 📜 License

MIT

✨ Happy diffex-ing!
